{
  "name": "BotFlow â†’ Zapier Webhooks",
  "nodes": [
    {
      "id": "webhook-trigger",
      "name": "BotFlow Event",
      "type": "n8n-nodes-base.webhook",
      "position": [250, 300],
      "parameters": {
        "httpMethod": "POST",
        "path": "botflow-zapier-{{bot_id}}",
        "responseMode": "onReceived"
      }
    },
    {
      "id": "format-zapier-payload",
      "name": "Format Zapier Payload",
      "type": "n8n-nodes-base.function",
      "position": [450, 300],
      "parameters": {
        "functionCode": "// Format data for Zapier webhook\nconst data = items[0].json;\n\nreturn [{\n  json: {\n    event_type: data.event_type || 'message_received',\n    timestamp: new Date().toISOString(),\n    bot_id: '{{bot_id}}',\n    organization_id: '{{organization_id}}',\n    conversation_id: data.conversation_id || '',\n    customer: {\n      phone: data.from || data.phone || '',\n      name: data.contact_name || data.name || 'Unknown',\n      email: data.email || `${data.from}@whatsapp.botflow.co.za`\n    },\n    message: {\n      text: data.message || data.body || '',\n      direction: data.direction || 'inbound',\n      intent: data.intent || 'general'\n    },\n    metadata: {\n      bot_name: data.bot_name || '',\n      vertical: data.vertical || '',\n      handoff_required: data.handoff_required || false,\n      sentiment: data.sentiment || 'neutral'\n    },\n    custom_fields: data.custom_fields || {}\n  }\n}];"
      }
    },
    {
      "id": "send-to-zapier",
      "name": "Send to Zapier Webhook",
      "type": "n8n-nodes-base.httpRequest",
      "position": [650, 300],
      "parameters": {
        "method": "POST",
        "url": "={{$json.zapier_webhook_url || '{{zapier_webhook_url}}'}}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{JSON.stringify($json)}}",
        "options": {
          "timeout": 10000
        }
      }
    }
  ],
  "connections": {
    "webhook-trigger": {
      "main": [
        [
          {
            "node": "format-zapier-payload",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "format-zapier-payload": {
      "main": [
        [
          {
            "node": "send-to-zapier",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "timezone": "Africa/Johannesburg",
    "saveExecutionProgress": true,
    "saveManualExecutions": true,
    "executionTimeout": 15
  }
}
