{
  "name": "BotFlow â†’ Ozow Instant EFT",
  "nodes": [
    {
      "id": "webhook-trigger",
      "name": "Create Ozow Payment",
      "type": "n8n-nodes-base.webhook",
      "position": [250, 300],
      "parameters": {
        "httpMethod": "POST",
        "path": "botflow-ozow-{{bot_id}}",
        "responseMode": "lastNode"
      }
    },
    {
      "id": "create-ozow-payment",
      "name": "Create Ozow Payment Request",
      "type": "n8n-nodes-base.function",
      "position": [450, 300],
      "parameters": {
        "functionCode": "// Create Ozow payment request\nconst crypto = require('crypto');\nconst data = items[0].json;\nconst amount = parseFloat(data.amount || 0).toFixed(2);\n\nconst siteCode = '{{site_code}}';\nconst privateKey = '{{private_key}}';\nconst apiKey = '{{api_key}}';\nconst countryCode = 'ZA';\nconst currencyCode = 'ZAR';\nconst transactionReference = data.transaction_reference || `TXN${Date.now()}`;\nconst bankReference = data.bank_reference || `BOT${Date.now()}`;\n\n// Generate hash check\nconst hashString = `${siteCode}${countryCode}${currencyCode}${amount}${transactionReference}${bankReference}${privateKey}`;\nconst hashCheck = crypto.createHash('sha512').update(hashString.toLowerCase()).digest('hex');\n\nconst ozowUrl = '{{is_test}}' === 'true'\n  ? 'https://pay.ozow.com'\n  : 'https://pay.ozow.com';\n\nconst paymentData = {\n  SiteCode: siteCode,\n  CountryCode: countryCode,\n  CurrencyCode: currencyCode,\n  Amount: amount,\n  TransactionReference: transactionReference,\n  BankReference: bankReference,\n  Customer: data.customer_name || 'Customer',\n  CancelUrl: `https://api.botflow.co.za/webhooks/ozow/cancel?bot_id={{bot_id}}`,\n  ErrorUrl: `https://api.botflow.co.za/webhooks/ozow/error?bot_id={{bot_id}}`,\n  SuccessUrl: `https://api.botflow.co.za/webhooks/ozow/success?bot_id={{bot_id}}`,\n  NotifyUrl: `https://api.botflow.co.za/webhooks/ozow/notify?bot_id={{bot_id}}`,\n  IsTest: '{{is_test}}' === 'true',\n  HashCheck: hashCheck\n};\n\nconst paymentUrl = `${ozowUrl}?${Object.entries(paymentData)\n  .map(([k, v]) => `${k}=${encodeURIComponent(v)}`)\n  .join('&')}`;\n\nreturn [{\n  json: {\n    success: true,\n    payment_url: paymentUrl,\n    transaction_reference: transactionReference,\n    amount: amount,\n    message: `Pay instantly with Ozow EFT (R${amount}): ${paymentUrl}`\n  }\n}];"
      }
    }
  ],
  "connections": {
    "webhook-trigger": {
      "main": [
        [
          {
            "node": "create-ozow-payment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "timezone": "Africa/Johannesburg",
    "saveExecutionProgress": true,
    "saveManualExecutions": true,
    "executionTimeout": 30
  }
}
